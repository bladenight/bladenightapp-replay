[#ftl]
<!doctype html>
<html lang='en'>
	<head>
		<meta charset='utf-8'>
		<title>Index</title>
		<link rel="stylesheet" href="style.css">
		
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyDYKMcZpChdiltJ7R4tn_OJwlJAeRtXdEU&sensor=false&libraries=geometry"></script>
		<script type="text/javascript" src="maplabel-compiled.js"></script>
		<script type="text/javascript" src="${currentEvent.dateIso}-route.js"></script>
		<script type="text/javascript" >
		function createDistanceMarkers(map, routeNodes) {
			var every = 1000
			var next = every;
			var dist = 0;
			var olddist = 0;
			for (var i=1; i < routeNodes.length; i++) {
				node1 = routeNodes[i-1];
				node2 = routeNodes[i];
				olddist = dist;
				dist += google.maps.geometry.spherical.computeDistanceBetween(node1, node2);
				while (dist > next) {
					 var m = (next-olddist)/(dist-olddist);
					 var p = new google.maps.LatLng( node1.lat() + (node2.lat()-node1.lat())*m, node1.lng() + (node2.lng()-node1.lng())*m);
					 createMarker(map, p, next / 1000);
					 next += every;
				}
			}
		}

		function initialize() {
			var mapOptions = {
				center: new google.maps.LatLng(48.132487, 11.5438976),
				zoom: 14,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};
			map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
			routeOverlay = new google.maps.Polyline({
				path: routeNodes,
				strokeColor: "#7000FF",
				strokeOpacity: 0.3,
				strokeWeight: 8,
				map: map
			});
			// console.log("setting overlay");

			createDistanceMarkers(map, routeNodes);
		}
		function createMarker(map, latlng, text) {
			var marker = new MapLabel({
				position:latlng,
				map:map,
				text: text
			});
		}
		google.maps.event.addDomListener(window, 'load', initialize);
		</script>
	</head>
	
	<body>
		<a href="index.html">Zurueck zum Index</a>
		<table>
		
			[#list images as image]
			<tr>
				[#if previousEvent??]
					<td><a href="${previousEvent.href}#${image}">${previousEvent.dateUserString}</a></td>
				[#else]
					<td></td>
				[/#if]
				<td><img id="${image}" src="${currentEvent.dateIso}-${image}.png"></td>
				[#if nextEvent??]
					<td><a href="${nextEvent.href}#${image}">${nextEvent.dateUserString}</a></td>
				[#else]
					<td></td>
				[/#if]
			</tr>
			[/#list]

			<tr>
				[#if previousEvent??]
					<td><a href="${previousEvent.href}#map_canvas">${previousEvent.dateUserString}</a></td>
				[#else]
					<td></td>
				[/#if]
				<td width="1200px" height="900px">
					<div id="map_canvas" style="width:100%; height:100%;"></div>
				</td>
				[#if nextEvent??]
					<td><a href="${nextEvent.href}#map_canvas">${nextEvent.dateUserString}</a></td>
				[#else]
					<td></td>
				[/#if]
			</tr>
		</table>
	</body>
</html>
